%! TEX root = main.tex

%/========== Acrobot ==========/%

\chapter{Application of VNHCs: The Acrobot}\label{ch:acrobot}
\section{Motivation}
The acrobot is a two-link pendulum, actuated at the center joint (as in Figure
\ref{fig:acrobot-model}). 
Since its first description in 1990
\cite{nonlinear_controllers_nonintegrable_acrobot}, the acrobot has become a
benchmark problem in control theory; 
it is an underactuated mechanical system which produces complex nonlinear motion
from an easy-to-describe model.
The acrobot models a gymnast on a bar, since it represents a torso (top link)
and legs (bottom link) with motion generated by the swinging of the legs at the
hips. 
It is also one of the simplest models for a biped walking robot
\cite{toward_framework_biped_locomotion}.

\begin{figure}
    \centering
    \includestandalone[width=0.7\textwidth]{images/acrobot_model}
    \caption{The general acrobot model, represented by two weighted rods
    differing in both length and mass.}%
    \label{fig:acrobot-model}
\end{figure}

Controlling the acrobot is a nontrivial task, since it is not feedback
linearizable \cite{nonlinear_controllers_nonintegrable_acrobot}. 
Several researchers have studied the swing-up problem of driving the acrobot to
its equilibrium point above the bar using partial feedback linearization
\cite{swingup_problem_acrobot}, energy-based control
\cite{swingup_acrobot_pendulum, swingup_acrobot_energy}, and through studying
human motion \cite{swingup_giant_acrobot, motion_control_gymnastic_skill}.

In gymnastics terminology, a ``giant" is the motion a gymnast performs to
achieve full rotations around the bar with their body almost fully extended
\cite{usagym_giant}. 
We are interested in studying the energy stabilization problem for the acrobot
by using VNHCs to generate giant motion. 
The control of giant motion for the acrobot has been studied thoroughly
\cite{energy_pumping_robotic_swinging, swingup_giant_acrobot,
control_giant_two_link_gymnastic_robot}, including several studies which use
virtual (holonomic) constraints to achieve this behaviour
\cite{dynamical_servo_acrobot_vc, control_giant_two_link_gymnastic_robot,
xingbo_thesis}. 
However, these controllers are neither intuitive nor easy to
design:
\cite{control_giant_two_link_gymnastic_robot} defines a constraint by inverting
a trajectory in time onto the state space; 
\cite{dynamical_servo_acrobot_vc} requires a cascade controller to stabilize
both a constraint and a desired limit cycle in the state space; 
and \cite{xingbo_thesis} enforces the giant by adding an extra state to estimate
the velocity, which increases the dimensionality of the problem in a crude
approach to using VNHCs.

In this chapter we will design a physically-intuitive VNHC which generates giant
motion. We will prove that this VNHC injects energy into the acrobot;
in the process of completing this proof, we will arrive at a promising method
which might be useful for generating desirable VNHCs in the future.

\section{Dynamics of the Acrobot}
Suppose we are given an acrobot as in Figure \ref{fig:acrobot-model} modelling a
gymnast hanging on a horizontal bar, where the ``torso" has moment of
inertia \(J_u\) and the ``leg" has moment of inertia \(J_a\) (each with respect
to their own center of mass).
Let \(q_u \in \mathbb{S}^1\) be the shoulder angle and \(q_a \in \mathbb{S}^1\) 
be the hip angle, where only \(q_a\) is actuated. 
Collecting them together provides the configuration
\(q = (q_u,q_a) \in \mathbb{S}^1 \times \mathbb{S}^1\). 
The acrobot has inertia matrix \(D\), potential function \(P\) (with respect to
the horizontal bar), and input matrix \(B\)  given as
follows \cite{xingbo_thesis}:
\begin{align}\label{eqn:general-acrobot-inertia}
    D(q) &= \begin{bmatrix}
      m_al_u^2 + 2m_a\cos(q_a)l_u l_{c_a} + m_al_{c_a}^2 + m_ul_{c_u}^2 + J_u + J_a &
      m_al_{c_a}^2 + m_al_ul_{c_a}\cos(q_a) + J_a \\
      m_al_{c_a}^2 + m_al_ul_{c_a}\cos(q_a) + J_a &
      m_al_{c_a}^2 + J_a
    \end{bmatrix} 
    , \\
    \label{eqn:general-acrobot-potential}
    P(q) &= g\left(m_al_{c_a}(1 - \cos(q_u+q_a)) + 
        (m_al_u + m_ul_{c_u})(1-\cos(q_u))\right) 
    , \\
    B(q) &= \begin{bmatrix} 0 \\ 1 \end{bmatrix}
    .
\end{align}

While this is the most general representation of an acrobot, the Hamiltonian
dynamics become too unwieldy for analytically proving results in this chapter.
We will therefore simplify the dynamics by assuming the acrobot is comprised of
two massless rods of equal length \(l\), with equal point masses \(m\) at the
tips (as in Figure \ref{fig:simple-acrobot-model}).
We call this type of acrobot a \textbf{simple} acrobot. We will also ignore any
frictional forces at both the hips and shoulder. 
Finally, it is important to note that a real gymnast cannot swing their hips in
full circles; 
for this reason, we assume that \(q_a \in [-\bar{q}_a, \bar{q}_a]\) where 
\(\bar{q}_a \in ]-\pi, \pi[\). 
If the acrobot is a robot as opposed to the model of a gymnast, 
\(\bar{q}_a\) can be used as a control parameter when designing VNHCs.

\begin{figure}
    \centering
    \includestandalone[width=0.7\textwidth]{images/simple_acrobot_model}
    \caption{A simple acrobot has massless rods of equal length \(l\) and 
    equal masses \(m\) at the tips.}
    \label{fig:simple-acrobot-model}
\end{figure}

Taking these assumptions on the model of a simple acrobot, 
the moments of inertia \(J_u\) and \(J_a\) of the rods vanish. 
Furthermore, \(l_{c_u} = l_{c_a} = l_u = l_a = l\) and
\(m_u = m_a = m\). 
Reducing
(\ref{eqn:general-acrobot-inertia}-\ref{eqn:general-acrobot-potential})
yields the simplified inertia matrix \(D_s\) and potential function \(P_s\),
where
\begin{align}
    D_s(q) &= \begin{bmatrix}
        ml^2\left(3+2\cos(q_a)\right) & 
        ml^2\left(1+\cos(q_a)\right) \\
        ml^2\left(1+\cos(q_a)\right) &
        ml^2
    \end{bmatrix} 
    , \\
    P_s(q) &= -mgl\left(2\cos(q_u)+\cos(q_u+q_a)\right)
    .
\end{align}
\begin{notation}
    For shorthand, we write \(c_u := \cos(q_u)\), \(c_a := \cos(q_a)\), and 
    \(c_{ua} := \cos(q_u + q_a)\). Likewise, \(s_u := \sin(q_u)\), 
    \(s_a := \sin(q_a)\), and \(s_{ua} := \sin(q_u + q_a)\).
\end{notation}

Defining \(M(q) := D_s(q)\) and \(V(q) := P_s(q)\), we find the conjugate of momenta 
is \(p = (p_u, p_a) = M(q)\dot{q}\).
The dynamics in \((q,p)\) coordinates are given by
\begin{align}\label{eqn:acrobot-hamiltonian}
    \mathcal{H}(q,p) &= \frac{1}{2}p\tpose \Minv(q) p -
    mgl\left(2 c_u + c_{ua}\right)\\
     &\begin{cases}
        \dot{q} = \Minv(q) p \\
        \dot{p}_u = -mgl\left(2s_u + s_{ua}\right) \\
        \dot{p}_a =-\frac{1}{2}p\tpose \nabla_{q_a}\Minv(q) p
        - mgl s_{ua} + \tau
    \end{cases} \nonumber
\end{align}
where the inverse inertia matrix is
\begin{equation}\label{eqn:Minv}
    \Minv(q) = \frac{1}{ml^2\left(2-c_a^2\right)}
    \begin{bmatrix}
        1 &
        -\left(1+c_a\right) \\
        -\left(1+c_a\right) &
        3+2c_a
    \end{bmatrix}
\end{equation}

\section{Previous Constraint Approaches}
% TODO: Give Xingbo's intuition, abstract away to qa = sin(theta) constraint
% based on VLP but show it doesn't work well in our framework
% TODO: Describe Xingbo's results and observe that his results were similar to a VNHC
% except they used VHC tools. We will modify his approach to use VNHCs and prove
% rigorously that we can stabilize any energy level set on the acrobot.

\section{The Acrobot Constraint}
% TODO: Give the constraint, state the theorem, and show the outline of the
% proof (both as a sketch and in a figure)
\section{Proving the Acrobot Gains Energy}
% TODO: Prove this in sections

\section{Experimental Results}
% TODO: This might be a separate chapter

%/========== /Acrobot ==========/%
% vim: set tw=80 ts=4 sw=4 sts=0 et ffs=unix :
